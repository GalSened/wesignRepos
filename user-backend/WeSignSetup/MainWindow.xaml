<Window
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"        
        x:Class="WeSignSetup.MainWindow"
        mc:Ignorable="d"
        SizeChanged="Window_SizeChanged"
        LocationChanged="Window_LocationChanged"
        Title="WeSign Setup" Height="788.467" Width="1356.3" Icon="ws.ico" >

    <Grid>

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="1*"/>
            <RowDefinition Height="4*"/>
        </Grid.RowDefinitions>

        <Border BorderBrush="Black" Grid.Row="0" Grid.Column="1" BorderThickness="2" Margin="10,10,10,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <StackPanel Grid.Row="0" Grid.Column="0">
                    <CheckBox TabIndex="0" HorizontalAlignment="Left" Margin="100,10,0,0" Name = "PCheckBox" Unchecked="PCheckBox_Unchecked" FontSize="18" Content = "Show\hide Prerequisites" IsChecked="True" Checked="PCheckBox_Checked"/>
                    <StackPanel Orientation="Horizontal">
                        <Label Name="deatilsLabel"  Content="Enter Your Server Details:" FontSize="40" HorizontalAlignment="Left" Margin="100,0,0,0" />
                        <Button  TabIndex="19"  Visibility="Visible" x:Name="backupButton" IsEnabled="True" Content="BACK UP" Margin="0,10,0,0" FontSize="19" HorizontalAlignment="Center" VerticalAlignment="Center" Width="200" Height="30" Click="backupButton_Click" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal">
                        <Label Name="previousVersion" Content="Previous version : " FontSize="20"></Label>
                    </StackPanel>
                    <Popup x:Name="popup" IsOpen = "{Binding ElementName = PCheckBox,Path = IsChecked}"    
         PlacementTarget = "{Binding ElementName = PCheckBox}"
         AllowsTransparency = "True" PopupAnimation = "Slide" Grid.RowSpan="2">

                        <Canvas x:Name="canvas" Width = "664" Height = "492" Background = "LightGray">
                            <Canvas.RenderTransform>
                                <RotateTransform x:Name = "theTransform" />
                            </Canvas.RenderTransform>
                            <TextBlock TextWrapping = "Wrap" Foreground = "Red" FontSize="20" TextAlignment="Center"
               Text = "Prerequisites: &#x0a;&#x0a;In order to continue installation,&#x0a;you must firstly install the following:&#x0a;.NetCore 3.1.4 , LibreOffice_6.3.5, &#x0a;.NetFramework 4.7.2, urlrewrite2, MSSQL&#x0a;&#x0a; For DB permission - create DB user with sysadmin and public permission, and make sure DB security authentication mode set to - SQL Server and windows authentication &#x0a;&#x0a;In addition,&#x0a;Make sure 'Web Platform Installer' exist and all following Windows Features are installed:&#x0a;IIS-WebServer" Height="402" Width="550" Canvas.Top="41" Canvas.Left="40" />
                        </Canvas>

                    </Popup>
                    <TextBlock x:Name="backupMessage" Visibility="Collapsed" FontSize="25" Foreground="Red" HorizontalAlignment="Center"> Backup task will take few minutes, please do not exit application</TextBlock>
                </StackPanel>
                <StackPanel Grid.Row="0" Grid.Column="1" >
                    <Image  Height="100" Width="300" Source="/Resources/ws_logo.png"/>
                    <Label Name="currentVersion"  Content="v3.2.0" FontSize="20" Margin="0,0,20,0" HorizontalAlignment="Right" />
                    
                </StackPanel>
                
            </Grid>
          
        </Border>

        <Grid x:Name="configurationSection" Grid.Row="1" Grid.Column="0" Margin="10,0,10,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*"/>
                <ColumnDefinition Width="1*"/>
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <RichTextBox Grid.Column="1" Grid.Row="0" x:Name="uiLogs" Background="Black" Foreground="WhiteSmoke" VerticalScrollBarVisibility="Visible" HorizontalAlignment="Left"  VerticalAlignment="Top" >
                <RichTextBox.RenderTransform>
                    <TransformGroup>
                        <ScaleTransform/>
                        <SkewTransform AngleY="0.291"/>
                        <RotateTransform/>
                        <TranslateTransform Y="0.995"/>
                    </TransformGroup>
                </RichTextBox.RenderTransform>
                <FlowDocument>
                    <Paragraph>
                        <Run Text="Logs:"/>
                    </Paragraph>
                </FlowDocument>
            </RichTextBox>

            <Grid Grid.Row="0" Grid.Column="0" >
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="5*"/>
                    <RowDefinition Height="5*"/>
                    <RowDefinition Height="1*"/>
                </Grid.RowDefinitions>

                <Border BorderBrush="Black" BorderThickness="2">

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="1.3*"/>
                            <ColumnDefinition Width="2*"/>
                            <ColumnDefinition Width="0.8*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Grid.Column="0" >
                            <Label Content="Domain Name(Legal):"  FontSize="18" HorizontalAlignment="Left" Margin="20,0,0,0" VerticalAlignment="Top" />
                            <TextBox TabIndex="1" x:Name="domainName" ToolTip="Enter LEGAL domain name, for example: 'wesign.example.com' or you can enter IP" ToolTipService.IsEnabled="True" HorizontalAlignment="Left" Height="23" Margin="20,0,0,5" TextWrapping="Wrap" Text="" VerticalAlignment="Top" Width="240"/>
                            <CheckBox TabIndex="2" Name = "OTP" FontSize="18" Margin="20,0,0,0" Content = "Use OTP For Management Site" IsChecked="False"/>
                            <Label Content="Base Data Folder Path:"  FontSize="18" HorizontalAlignment="Left" Margin="20,0,0,0" VerticalAlignment="Top" />
                            <TextBox TabIndex="1" x:Name="baseDataFolder" ToolTip="For example: D:\Comda\Wesign\Data" ToolTipService.IsEnabled="True" HorizontalAlignment="Left" Height="23" Margin="20,0,0,5" TextWrapping="Wrap" Text="D:\Comda\Wesign\Data" VerticalAlignment="Top" Width="240"/>
                            <CheckBox TabIndex="3" Name = "exposeManagement" FontSize="18" Margin="20,0,0,0" Content = "Allow RDP to management site" IsChecked="False"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Grid.Row="0" >
                            <Label Margin="20,0,0,0" FontWeight="Bold" FontSize="18" Content="How to sign documents using certificate?"/>                            
                            <RadioButton TabIndex="3" x:Name="caOption1" FontSize="18"  Checked="caOption1_Checked" >
                                <TextBlock Text="Using Exist CA - which will create certificate for each contact and user" 
                                    TextWrapping="Wrap"/>
                            </RadioButton>
                            <RadioButton TabIndex="4" x:Name="caOption2" FontSize="18" Checked="caOption2_Checked">
                                <TextBlock Text="Create new CA - which will create certificate for each contact and user" 
                                    TextWrapping="Wrap"/>
                            </RadioButton>
                            <RadioButton TabIndex="5" x:Name="caOption3" FontSize="18" ToolTip="Recommended" ToolTipService.IsEnabled="True" IsChecked="True"  Checked="caOption3_Checked" >
                                <TextBlock Text="Without CA - using one global certificate created by Comda Ltd" 
                                    TextWrapping="Wrap"/>
                            </RadioButton>
                            <Label Content="CA Name:" HorizontalAlignment="Left" FontSize="18"/>
                            <TextBox  TabIndex="6" x:Name="CAIpAndName" HorizontalAlignment="Left" ToolTip="For example: 123.456.7.89\WESIGN-EXAMPLE-CA" ToolTipService.IsEnabled="True" Height="23" TextWrapping="Wrap" Text="" Width="240" IsEnabled="False"/>


                        </StackPanel>
                        <Button Grid.Column="2" Grid.Row="0" FontSize="18" Click="UpdateConfigFiles" Height="60" Width="150" Name="updateConfigFilesButton" HorizontalAlignment="Center"  VerticalAlignment="Center" >
                            <TextBlock Text="Update Configuration files" VerticalAlignment="Center"
                                    TextWrapping="Wrap"/>
                        </Button>


                    </Grid>
                </Border>

                <Grid Grid.Row="1" Grid.Column="0">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Border Grid.Row="0" Grid.Column="0" BorderBrush="Black" BorderThickness="2">

                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="1*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <Label Content="SQL Data:" FontSize="18" Margin="10,0,0,10" FontWeight="Bold" HorizontalAlignment="Left" VerticalAlignment="Top" />
                                    <StackPanel Orientation="Horizontal">
                                        <Label Content="Server Name:"  FontSize="18" Margin="10,0,0,0"/>
                                        <TextBox TabIndex="7" x:Name="sqlDataSource" ToolTip="For example: WESIGN-SERVER\SQLEXPRESS" ToolTipService.IsEnabled="True" HorizontalAlignment="Left" Height="23" TextWrapping="Wrap" VerticalAlignment="Top" Width="190" />
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal">
                                        <Label Content="DB Name:"  FontSize="18" Margin="10,0,0,0" />
                                        <TextBox TabIndex="8" x:Name="sqlDbName" Margin="25,0,0,10" ToolTip="For example: WeSign" Text="WeSign" ToolTipService.IsEnabled="True" HorizontalAlignment="Left" Height="23"  TextWrapping="Wrap" VerticalAlignment="Top" Width="190" />
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal">
                                        <Label Content="DB User:" Margin="10,0,0,0" FontSize="18" HorizontalAlignment="Left"  VerticalAlignment="Top"  />
                                        <TextBox TabIndex="9" x:Name="sqlUserId" Text="sa"  Margin="35,0,0,10" HorizontalAlignment="Left" Height="23" TextWrapping="Wrap" VerticalAlignment="Top" Width="190" />
                                    </StackPanel>
                                    <StackPanel Orientation="Horizontal">
                                        <Label Content="Password:" FontSize="18" Margin="10,0,0,0" HorizontalAlignment="Left" VerticalAlignment="Top"  />
                                        <PasswordBox x:Name="sqlPassword" Margin="25,0,0,10" HorizontalAlignment="Left" VerticalAlignment="Top"  TabIndex="10" Height="23" Width="190" PasswordChanged="sqlPassword_PasswordChanged"/>
                                        <TextBox x:Name="textSqlPassword" Margin="25,0,0,10" HorizontalAlignment="Left" VerticalAlignment="Top"  TabIndex="10" Height="23" Width="190" Visibility="Collapsed" TextChanged="textSqlPassword_TextChanged"/>
                                        <Image Margin="2,0,0,10" Height="12" Width="13"  Source="/Resources/icons8-eye-24.png" MouseDown="Image_MouseDown" />

                                    </StackPanel>
                                    <CheckBox   TabIndex="11" Margin="10,10,10,10" Name = "windowsAuth" FontSize="18"  Content="Use windows authentication" IsChecked="False" />
                                </StackPanel>
                                <StackPanel x:Name="sp" Grid.Row="0" Grid.Column="1">
                                    <Button Content="Create DB" Margin="0,70,0,10" Height="40" Width="120" FontSize="18" Click="UpdateDB" Name="updateDbButton" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                </StackPanel>

                            </Grid>

                        </Border>
                        <Border Grid.Row="0" Grid.Column="1" BorderBrush="Black" BorderThickness="2" >
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <StackPanel Grid.Row="0" Grid.Column="0">
                                    <StackPanel Margin="10,0,0,0">
                                        <Label Content="IIS - Main Site:" FontWeight="Bold" HorizontalAlignment="Left" VerticalAlignment="Top" FontSize="18" />
                                        <RadioButton TabIndex="12" x:Name="useDefaultWebSite" GroupName="iisSite" FontSize="18" Checked="useDefaultWebSite_Checked"  ToolTipService.IsEnabled="True" IsChecked="True" Content="Use Default Web Site" HorizontalAlignment="Left" VerticalAlignment="Top" />
                                        <RadioButton TabIndex="13" x:Name="useNewWebSite" GroupName="iisSite" FontSize="18" Checked="useNewWebSite_Checked" ToolTipService.IsEnabled="True" Content="Create New Web Site" HorizontalAlignment="Left" VerticalAlignment="Top" />
                                        <StackPanel Orientation="Horizontal" >
                                            <StackPanel Orientation="Vertical">
                                                <Label Content="Site Name:" HorizontalAlignment="Left"  VerticalAlignment="Top" FontSize="18"/>
                                                <TextBox TabIndex="14" x:Name="siteNameInput" IsEnabled="False"  HorizontalAlignment="Left" Height="23" TextWrapping="Wrap" Text="" VerticalAlignment="Top" Width="132"  />
                                            </StackPanel>
                                            <StackPanel Margin="20,0,0,0">
                                                <Label Content="Port:" HorizontalAlignment="Left"  VerticalAlignment="Top" FontSize="18" />
                                                <TextBox  TabIndex="15" x:Name="sitePortInput" IsEnabled="False" Text="80"  HorizontalAlignment="Left" Height="23"  TextWrapping="Wrap" VerticalAlignment="Top" Width="76" />
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>

                                    <StackPanel Margin="10,10,0,10">
                                        <Label Content="IIS -  Management Site:" FontWeight="Bold" HorizontalAlignment="Left"  VerticalAlignment="Top" FontSize="18" />
                                        <StackPanel  Orientation="Horizontal" >
                                            <StackPanel>
                                                <Label Content="Site Name:" HorizontalAlignment="Left"  VerticalAlignment="Top" FontSize="18"/>
                                                <TextBox TabIndex="16" x:Name="managementSiteNameInput" Text="Management" HorizontalAlignment="Left" Height="23"  TextWrapping="Wrap" VerticalAlignment="Top" Width="118" />
                                            </StackPanel>
                                            <StackPanel Margin="35,0,0,0">
                                                <Label Content="Port:" HorizontalAlignment="Left"  VerticalAlignment="Top" FontSize="18"/>
                                                <TextBox TabIndex="17"  x:Name="managementPortInput"  Text="10443" HorizontalAlignment="Left" Height="23" TextWrapping="Wrap" VerticalAlignment="Top" Width="76"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </StackPanel>

                                </StackPanel>
                                <StackPanel Grid.Row="0" Grid.Column="1">
                                    <Button Content="Create Sites" Margin="0,70,0,70" Height="40" Width="120" FontSize="18" HorizontalAlignment="Center" VerticalAlignment="Center" Click="UpdateIIS" Name="createSitesButton" />
                                </StackPanel>

                            </Grid>

                        </Border>

                    </Grid>
                </Grid>

                <StackPanel Grid.Row="2" Grid.Column="0" Orientation="Vertical" >
                    <!--<TextBlock x:Name="backupMessage" Visibility="Collapsed" FontSize="25" Foreground="Red" HorizontalAlignment="Center"> Backup task will take few minutes, please do not exit application </TextBlock>
                    <Button  TabIndex="19"  Visibility="Collapsed" x:Name="backupButton" IsEnabled="True" Content="BACK UP" Margin="0,10,0,0" FontSize="19" HorizontalAlignment="Center" VerticalAlignment="Center" Width="660" Height="30" Click="backupButton_Click" />-->
                    <Button  TabIndex="19" Visibility="Collapsed" x:Name="submitButton" IsEnabled="False" Content="SUBMIT" Margin="0,10,0,0" FontSize="19" HorizontalAlignment="Center" VerticalAlignment="Center" Width="660" Height="38" Click="Submit" />
                    <ProgressBar Name="pbStatus" Visibility="Collapsed" Minimum="0" Maximum="100" Margin="0,2,0,0" Height="30" IsIndeterminate="True"/>
                </StackPanel>
            </Grid>
        </Grid>
    </Grid>
</Window>